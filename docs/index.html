<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Fonts WOFF2 Downloader</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #4285f4;
            --primary-hover: #357ae8;
            --secondary-color: #34a853;
            --background: #f8f9fa;
            --card-bg: #ffffff;
            --text-primary: #202124;
            --text-secondary: #5f6368;
            --border-color: #dadce0;
            --shadow: 0 1px 2px 0 rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
            --shadow-hover: 0 1px 3px 0 rgba(60, 64, 67, 0.3), 0 4px 8px 3px rgba(60, 64, 67, 0.15);
        }

        body {
            font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: var(--card-bg);
            padding: 40px 20px;
            text-align: center;
            box-shadow: var(--shadow);
            margin-bottom: 40px;
        }

        h1 {
            font-size: 2.5em;
            font-weight: 600;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #4285f4, #34a853);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1em;
        }

        .search-section {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        input[type="text"] {
            flex: 1;
            padding: 14px 20px;
            font-size: 16px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.1);
        }

        button {
            padding: 14px 30px;
            font-size: 16px;
            font-weight: 600;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: var(--shadow-hover);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .preview-section {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
            display: none;
        }

        .preview-section.active {
            display: block;
        }

        .preview-text {
            font-size: 48px;
            margin: 20px 0;
            padding: 20px;
            background: var(--background);
            border-radius: 8px;
            text-align: center;
        }

        .font-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .info-card {
            background: var(--background);
            padding: 15px;
            border-radius: 8px;
        }

        .info-label {
            font-size: 0.9em;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.1em;
            font-weight: 600;
        }

        .variants-section {
            margin-top: 30px;
        }

        .variants-title {
            font-size: 1.3em;
            font-weight: 600;
            margin-bottom: 15px;
        }

        .variants-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .variant-checkbox {
            display: flex;
            align-items: center;
            padding: 12px;
            background: var(--background);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .variant-checkbox:hover {
            border-color: var(--primary-color);
            background: rgba(66, 133, 244, 0.05);
        }

        .variant-checkbox input[type="checkbox"] {
            margin-right: 8px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .variant-checkbox.selected {
            background: rgba(66, 133, 244, 0.1);
            border-color: var(--primary-color);
        }

        .download-section {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-top: 20px;
        }

        .btn-download {
            background: var(--secondary-color);
            flex: 1;
        }

        .btn-download:hover {
            background: #2d8e47;
        }

        .btn-select-all {
            background: var(--text-secondary);
        }

        .btn-select-all:hover {
            background: #4a4e52;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .spinner {
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #fce8e6;
            color: #c5221f;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }

        .error.active {
            display: block;
        }

        .success {
            background: #e6f4ea;
            color: #137333;
            padding: 15px 20px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }

        .success.active {
            display: block;
        }

        .instructions {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .instructions h2 {
            font-size: 1.5em;
            margin-bottom: 15px;
        }

        .instructions ul {
            list-style-position: inside;
            color: var(--text-secondary);
        }

        .instructions li {
            margin: 8px 0;
        }

        footer {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
            font-size: 0.9em;
        }

        footer a {
            color: var(--primary-color);
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }

            .search-box {
                flex-direction: column;
            }

            .preview-text {
                font-size: 32px;
            }

            .download-section {
                flex-direction: column;
            }

            .btn-download, .btn-select-all {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>üî§ Google Fonts WOFF2 Downloader</h1>
        <p class="subtitle">T√©l√©chargez vos polices Google Fonts pr√©f√©r√©es au format WOFF2</p>
    </header>

    <div class="container">
        <div class="instructions">
            <h2>üìñ Comment utiliser</h2>
            <ul>
                <li>Entrez le nom d'une police Google Fonts (ex: "Roboto", "Open Sans")</li>
                <li>Pr√©visualisez la police en temps r√©el</li>
                <li>S√©lectionnez les variantes que vous souhaitez t√©l√©charger</li>
                <li>Cliquez sur "T√©l√©charger les fichiers WOFF2" pour obtenir vos polices</li>
            </ul>
        </div>

        <div class="search-section">
            <div class="search-box">
                <input
                    type="text"
                    id="fontInput"
                    placeholder="Entrez le nom de la police (ex: Roboto, Inter, Poppins...)"
                    autocomplete="off"
                >
                <button id="searchBtn">üîç Rechercher</button>
            </div>
            <div class="error" id="errorMsg"></div>
        </div>

        <div id="loadingSection" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Chargement de la police...</p>
        </div>

        <div class="preview-section" id="previewSection">
            <h2>Aper√ßu de la police</h2>

            <div class="preview-text" id="previewText" style="font-family: Arial;">
                The quick brown fox jumps over the lazy dog
                <br>
                <span style="font-size: 0.7em;">0123456789 √Ä√â√à√ä√ã√è√î√ô √†√©√®√™√´√Ø√¥√π</span>
            </div>

            <div class="font-info">
                <div class="info-card">
                    <div class="info-label">Nom de la police</div>
                    <div class="info-value" id="fontName">-</div>
                </div>
                <div class="info-card">
                    <div class="info-label">Variantes disponibles</div>
                    <div class="info-value" id="variantCount">0</div>
                </div>
            </div>

            <div class="variants-section">
                <h3 class="variants-title">S√©lectionner les variantes √† t√©l√©charger</h3>
                <div class="variants-grid" id="variantsGrid"></div>

                <div class="download-section">
                    <button class="btn-select-all" id="selectAllBtn">Tout s√©lectionner</button>
                    <button class="btn-download" id="downloadBtn" disabled>
                        üì• T√©l√©charger les fichiers WOFF2 (<span id="selectedCount">0</span>)
                    </button>
                </div>

                <div class="success" id="successMsg"></div>
            </div>
        </div>
    </div>

    <footer>
        <p>
            Cr√©√© avec ‚ù§Ô∏è |
            <a href="https://github.com/robindelporte/Font-downloader" target="_blank">GitHub</a> |
            <a href="https://fonts.google.com" target="_blank">Google Fonts</a>
        </p>
    </footer>

    <script>
        let currentFontData = null;
        let selectedVariants = new Set();

        const fontInput = document.getElementById('fontInput');
        const searchBtn = document.getElementById('searchBtn');
        const loadingSection = document.getElementById('loadingSection');
        const previewSection = document.getElementById('previewSection');
        const previewText = document.getElementById('previewText');
        const fontName = document.getElementById('fontName');
        const variantCount = document.getElementById('variantCount');
        const variantsGrid = document.getElementById('variantsGrid');
        const downloadBtn = document.getElementById('downloadBtn');
        const selectAllBtn = document.getElementById('selectAllBtn');
        const errorMsg = document.getElementById('errorMsg');
        const successMsg = document.getElementById('successMsg');
        const selectedCount = document.getElementById('selectedCount');

        // Search on Enter key
        fontInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchFont();
            }
        });

        searchBtn.addEventListener('click', searchFont);
        selectAllBtn.addEventListener('click', selectAllVariants);
        downloadBtn.addEventListener('click', downloadSelectedFonts);

        async function searchFont() {
            const fontFamily = fontInput.value.trim();

            if (!fontFamily) {
                showError('Veuillez entrer un nom de police');
                return;
            }

            hideError();
            hideSuccess();
            showLoading();
            previewSection.classList.remove('active');

            try {
                // Build Google Fonts CSS URL
                const cssUrl = buildGoogleFontsUrl(fontFamily);

                // Fetch CSS
                const cssContent = await fetchFontCSS(cssUrl);

                // Parse CSS to extract font data
                const fontData = parseFontCSS(cssContent, fontFamily);

                if (fontData.variants.length === 0) {
                    throw new Error('Aucune variante trouv√©e pour cette police');
                }

                currentFontData = fontData;
                displayFontPreview(fontData);

                // Load font for preview
                loadFontForPreview(fontFamily, cssUrl);

            } catch (error) {
                showError(`Erreur: ${error.message}`);
                console.error(error);
            } finally {
                hideLoading();
            }
        }

        function buildGoogleFontsUrl(fontFamily) {
            const family = fontFamily.replace(/\s+/g, '+');
            return `https://fonts.googleapis.com/css2?family=${family}:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap`;
        }

        async function fetchFontCSS(url) {
            const response = await fetch(url);
            if (!response.ok) {
                throw new Error('Police non trouv√©e ou indisponible');
            }
            return await response.text();
        }

        function parseFontCSS(css, fontFamily) {
            const variants = [];
            const urlPattern = /url\((https:\/\/[^)]+\.woff2)\)/g;
            const fontFacePattern = /@font-face\s*{[^}]*}/g;

            const fontFaces = css.match(fontFacePattern) || [];

            fontFaces.forEach(fontFace => {
                const urlMatch = fontFace.match(/url\((https:\/\/[^)]+\.woff2)\)/);
                const weightMatch = fontFace.match(/font-weight:\s*(\d+)/);
                const styleMatch = fontFace.match(/font-style:\s*(\w+)/);

                if (urlMatch) {
                    const weight = weightMatch ? weightMatch[1] : '400';
                    const style = styleMatch ? styleMatch[1] : 'normal';
                    const variant = `${weight}${style === 'italic' ? 'i' : ''}`;

                    variants.push({
                        weight: weight,
                        style: style,
                        variant: variant,
                        url: urlMatch[1],
                        label: getVariantLabel(weight, style)
                    });
                }
            });

            return {
                family: fontFamily,
                variants: variants
            };
        }

        function getVariantLabel(weight, style) {
            const weights = {
                '100': 'Thin',
                '200': 'Extra Light',
                '300': 'Light',
                '400': 'Regular',
                '500': 'Medium',
                '600': 'Semi Bold',
                '700': 'Bold',
                '800': 'Extra Bold',
                '900': 'Black'
            };

            const weightName = weights[weight] || weight;
            return style === 'italic' ? `${weightName} Italic` : weightName;
        }

        function loadFontForPreview(fontFamily, cssUrl) {
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = cssUrl;
            document.head.appendChild(link);

            link.onload = () => {
                previewText.style.fontFamily = `'${fontFamily}', sans-serif`;
            };
        }

        function displayFontPreview(fontData) {
            fontName.textContent = fontData.family;
            variantCount.textContent = fontData.variants.length;

            // Clear and populate variants
            variantsGrid.innerHTML = '';
            selectedVariants.clear();

            fontData.variants.forEach(variant => {
                const checkbox = createVariantCheckbox(variant);
                variantsGrid.appendChild(checkbox);
            });

            previewSection.classList.add('active');
            updateDownloadButton();
        }

        function createVariantCheckbox(variant) {
            const label = document.createElement('label');
            label.className = 'variant-checkbox';

            const checkbox = document.createElement('input');
            checkbox.type = 'checkbox';
            checkbox.value = variant.variant;
            checkbox.dataset.url = variant.url;
            checkbox.dataset.label = variant.label;

            checkbox.addEventListener('change', (e) => {
                if (e.target.checked) {
                    selectedVariants.add(variant);
                    label.classList.add('selected');
                } else {
                    selectedVariants.delete(variant);
                    label.classList.remove('selected');
                }
                updateDownloadButton();
            });

            const text = document.createTextNode(variant.label);

            label.appendChild(checkbox);
            label.appendChild(text);

            return label;
        }

        function selectAllVariants() {
            const checkboxes = variantsGrid.querySelectorAll('input[type="checkbox"]');
            const allSelected = Array.from(checkboxes).every(cb => cb.checked);

            checkboxes.forEach(cb => {
                cb.checked = !allSelected;
                cb.dispatchEvent(new Event('change'));
            });

            selectAllBtn.textContent = allSelected ? 'Tout s√©lectionner' : 'Tout d√©s√©lectionner';
        }

        function updateDownloadButton() {
            const count = selectedVariants.size;
            selectedCount.textContent = count;
            downloadBtn.disabled = count === 0;
        }

        async function downloadSelectedFonts() {
            if (selectedVariants.size === 0) return;

            downloadBtn.disabled = true;
            downloadBtn.textContent = '‚è≥ T√©l√©chargement en cours...';
            hideSuccess();

            try {
                let downloaded = 0;

                for (const variant of selectedVariants) {
                    await downloadFont(variant);
                    downloaded++;
                }

                showSuccess(`‚úÖ ${downloaded} fichier${downloaded > 1 ? 's' : ''} t√©l√©charg√©${downloaded > 1 ? 's' : ''} avec succ√®s !`);

            } catch (error) {
                showError(`Erreur lors du t√©l√©chargement: ${error.message}`);
            } finally {
                downloadBtn.disabled = false;
                downloadBtn.innerHTML = `üì• T√©l√©charger les fichiers WOFF2 (<span id="selectedCount">${selectedVariants.size}</span>)`;
            }
        }

        async function downloadFont(variant) {
            const response = await fetch(variant.url);
            if (!response.ok) {
                throw new Error(`√âchec du t√©l√©chargement de ${variant.label}`);
            }

            const blob = await response.blob();
            const url = window.URL.createObjectURL(blob);

            const filename = generateFilename(currentFontData.family, variant);

            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);

            // Small delay between downloads
            await new Promise(resolve => setTimeout(resolve, 100));
        }

        function generateFilename(family, variant) {
            const safeName = family.replace(/\s+/g, '-').toLowerCase();
            const weight = variant.weight;
            const style = variant.style === 'italic' ? '-italic' : '';
            return `${safeName}-${weight}${style}.woff2`;
        }

        function showLoading() {
            loadingSection.style.display = 'block';
        }

        function hideLoading() {
            loadingSection.style.display = 'none';
        }

        function showError(message) {
            errorMsg.textContent = message;
            errorMsg.classList.add('active');
        }

        function hideError() {
            errorMsg.classList.remove('active');
        }

        function showSuccess(message) {
            successMsg.textContent = message;
            successMsg.classList.add('active');
        }

        function hideSuccess() {
            successMsg.classList.remove('active');
        }
    </script>
</body>
</html>
